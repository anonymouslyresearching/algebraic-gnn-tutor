# ðŸ“Š Dataset Directory

This directory contains the datasets used for training and evaluating the Graph Neural Tutor.

## Dataset Generation

Datasets are automatically generated when running the training pipeline:

```bash
python main.py  # Generates full dataset with 2,850 examples
```

## Dataset Structure

### Synthetic Dataset (Default)
- **Total Examples**: 2,850
- **Positive Examples**: 2,250 (9 rules Ã— 250 examples each)
- **Negative Examples**: 600 (corrupted transformations)
- **Format**: PyTorch Geometric Data objects

### Rule Categories

| Rule ID | Rule Name | Description | Examples |
|---------|-----------|-------------|----------|
| 0 | `add_const` | Add/subtract constant | `3x + 5 = 11 â†’ 3x = 6` |
| 1 | `sub_const` | Subtract constant | `3x - 2 = 10 â†’ 3x = 12` |
| 2 | `div_coeff` | Divide by coefficient | `3x = 12 â†’ x = 4` |
| 3 | `mul_denom` | Multiply by denominator | `x/4 = 3 â†’ x = 12` |
| 4 | `expand` | Expand expressions | `(x+2)(x+3) â†’ xÂ²+5x+6` |
| 5 | `factor` | Factor expressions | `xÂ²+5x+6 â†’ (x+2)(x+3)` |
| 6 | `pow_reduce` | Apply roots/powers | `xÂ² = 16 â†’ x = Â±4` |
| 7 | `combine_fracs` | Combine fractions | `2/3 + 1/6 â†’ 5/6` |
| 8 | `sub_var` | Subtract variables | `3x+5 = 2x+8 â†’ x = 3` |

## Dataset Files

After generation, you'll find:

- **`dataset_TIMESTAMP.pt`** - Complete dataset with graph representations
- **`dataset_TIMESTAMP_metadata.json`** - Dataset information and statistics
- **`sample_dataset.pt`** - Small dataset for quick testing (generated by quickstart)

## Data Format

Each example contains:
```python
Data(
    x=tensor([[node_type, depth], ...]),      # Node features
    edge_index=tensor([[source], [target]]),   # Graph edges
    y_rule=tensor([rule_id]),                  # Target rule classification
    y_ptr=tensor([target_node_idx]),           # Target node for attention
    y_val=tensor([validity_score]),            # Transformation validity (0 or 1)
    equation_str="original equation string"    # Human-readable equation
)
```

## Custom Dataset Integration

To use your own educational data:

```python
def load_custom_dataset():
    """
    Load your custom algebraic transformation data
    Returns: List of PyTorch Geometric Data objects
    """
    dataset = []
    
    # Your data loading logic here
    for equation_pair in your_data:
        graph = create_ast_graph(equation_pair.original)
        graph.y_rule = torch.tensor([equation_pair.rule_id])
        graph.y_ptr = torch.tensor([equation_pair.target_node])
        graph.y_val = torch.tensor([equation_pair.is_valid])
        dataset.append(graph)
    
    return dataset

# Use in training
from main import kfold_multiseed_eval
dataset = load_custom_dataset()
results = kfold_multiseed_eval(dataset)
```

## Dataset Statistics

### Distribution by Rule Type
```
add_const:      250 examples (8.8%)
sub_const:      250 examples (8.8%)
div_coeff:      250 examples (8.8%)
mul_denom:      250 examples (8.8%)
expand:         250 examples (8.8%)
factor:         250 examples (8.8%)
pow_reduce:     250 examples (8.8%)
combine_fracs:  250 examples (8.8%)
sub_var:        250 examples (8.8%)
negative:       600 examples (21.1%)
```

### Graph Complexity
- **Average nodes per graph**: 8.4 Â± 3.2
- **Average edges per graph**: 14.7 Â± 6.1
- **Maximum depth**: 20 levels
- **Node types**: 8 different AST node types

## Real-World Data Integration

For educational applications, you can integrate real student data:

```python
def load_educational_data(csv_file):
    """
    Load real educational data from CSV
    Expected columns: original_equation, transformed_equation, rule_type, is_correct
    """
    import pandas as pd
    
    df = pd.read_csv(csv_file)
    dataset = []
    
    for _, row in df.iterrows():
        try:
            # Parse equations using SymPy
            original = sp.sympify(row['original_equation'])
            transformed = sp.sympify(row['transformed_equation'])
            
            # Create graph representation
            graph = create_ast_graph(sp.Eq(original, 0))
            graph.y_rule = torch.tensor([RULE_MAP[row['rule_type']]])
            graph.y_val = torch.tensor([float(row['is_correct'])])
            
            dataset.append(graph)
        except Exception as e:
            print(f"Skipping invalid equation: {e}")
    
    return dataset
```

## Data Validation

All generated examples are automatically validated:

1. **Symbolic Correctness**: SymPy verification of mathematical validity
2. **Graph Connectivity**: Ensures all nodes are reachable
3. **Rule Consistency**: Verifies transformation matches assigned rule
4. **Difficulty Balance**: Maintains appropriate complexity distribution

## Performance Considerations

- **Memory Usage**: ~50MB for full dataset (2,850 examples)
- **Loading Time**: ~2-3 seconds on standard hardware
- **Graph Size**: Optimized for educational complexity levels
- **Batch Processing**: Supports efficient batch loading with DataLoader

## Citation and Usage

This synthetic dataset is designed for educational AI research. When using in publications:

```bibtex
@dataset{gnn_algebra_dataset2025,
  title={Synthetic Algebraic Transformation Dataset},
  author={Anonymous Authors},
  year={2025},
  note={Generated for Graph Neural Tutor research}
}
```
